syntax = "proto3";

option csharp_namespace = "RaceServer";

package race;

service GameService {
	rpc RoomStream (RoomStreamRequest) returns (stream RoomStreamResponse);
	rpc JoinRoom (JoinRoomRequest) returns (JoinRoomResponse);
	rpc LeaveRoom (LeaveRoomRequest) returns (LeaveRoomResponse);
	rpc PlayerReady (PlayerReadyRequest) returns (PlayerReadyResponse);
	rpc StartMatch (StartMatchRequest) returns (StartMatchResponse);
	rpc UpdateSeeds (UpdateSeedsRequest) returns (UpdateSeedsResponse);
	rpc EndGame (EndGameRequest) returns (EndGameResponse);
	rpc EndMatch (EndMatchRequest) returns (EndMatchResponse);
}

message RoomUser {
	string user_id = 1;
	string username = 2;
	string role = 3;
	bool host = 4;
	bool ready = 5;
	int32 seed = 6;
	int32 profile_picture = 7;
	string name_color = 8;
	string shadow_color = 9;
	string outline_color = 10;
	string background_color = 11;
	repeated string hex_codes = 12;
}

message RoomStreamRequest {
	string user_id = 1;
	string permanent_token = 2;
	string role = 3;
}

message RoomStreamResponse {
	oneof message {
		JoinRoomNotification join_room_notification = 1;
		LeaveRoomNotification leave_room_notification = 2;
		PlayerReadyNotification player_ready_notification = 3;
		StartMatchNotification start_match_notification = 4;
		UpdateSeedsNotification update_seeds_notification = 5;
		EndGameNotification end_game_notification = 6;
		EndMatchNotification end_match_notification = 7;
	}
}

message JoinRoomRequest {
	string user_id = 1;
	string permanent_token = 2;
	string role = 3;
}

message JoinRoomResponse {
	bool success = 1;
	string message = 2;
	RoomUser user = 3;
}

message LeaveRoomRequest {
	string user_id = 1;
	string permanent_token = 2;
}

message LeaveRoomResponse {
	bool success = 1;
	string message = 2;
}

message JoinRoomNotification {
	repeated RoomUser users = 1;
	bool all_ready = 2;
}

message LeaveRoomNotification {
	repeated RoomUser users = 1;
	string username = 2;
}

message PlayerReadyRequest {
	string user_id = 1;
	string permanent_token = 2;
}

message PlayerReadyResponse {
	bool success = 1;
	string message = 2;
	bool ready = 3;
}

message PlayerReadyNotification {
	repeated RoomUser users = 1;
	bool all_ready = 2;
}

message StartMatchRequest {
	string user_id = 1;
	string permanent_token = 2;
}

message StartMatchResponse {
	bool success = 1;
	string message = 2;
}

message StartMatchNotification {
	bool match_started = 1;
	repeated RoomUser players = 2;
}

message UpdateSeedsRequest {
	string user_id = 1;
	string permanent_token = 2;
}

message UpdateSeedsResponse {
	bool success = 1;
	string message = 2;
}

message UpdateSeedsNotification {
	repeated RoomUser users = 1;
}

message EndGameRequest {
	string user_id = 1;
	string permanent_token = 2;
	double finish_time = 3;
}

message EndGameResponse {
	bool success = 1;
	string message = 2;
}

message EndGameNotification {
	string winner_id = 1;
	double finish_time = 2;
}

message EndMatchRequest {
	string user_id = 1;
	string permanent_token = 2;
}

message EndMatchResponse {
	bool success = 1;
	string message = 2;
}

message EndMatchNotification {
	string winner_id = 1;
	int32 games_won = 2;
	int32 games_lost = 3;
}